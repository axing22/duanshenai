<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æ®µæ°¸å¹³æ™ºæ…§AIå¯¹è¯ - æŠ•èµ„Â·æ•™è‚²Â·AIÂ·ä¼ä¸šç»è¥çš„äººç”Ÿå“²å­¦</title>
    <meta name="description" content="åŸºäºDeepSeek AIå’Œæ®µæ°¸å¹³ç†å¿µçš„æ™ºèƒ½å¯¹è¯ç³»ç»Ÿï¼Œä¸ºæ‚¨æä¾›æŠ•èµ„ã€æ•™è‚²ã€AIã€ä¼ä¸šç»è¥ç­‰æ–¹é¢çš„æ·±åº¦æŒ‡å¯¼">
    
    <!-- å­—ä½“å¼•å…¥ -->
    <link href="https://fonts.googleapis.com/css2?family=Noto+Serif+SC:wght@400;700&family=Noto+Sans+SC:wght@300;400;500;700&family=ZCOOL+XiaoWei&display=swap" rel="stylesheet">
    
    <!-- æ ¸å¿ƒåº“ -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/animejs/3.2.1/anime.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/p5.js/1.7.0/p5.min.js"></script>
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <style>
        :root {
            --primary-blue: #2C3E50;
            --warm-white: #F8F9FA;
            --elegant-gray: #6C757D;
            --wisdom-gold: #D4AF37;
            --nature-green: #28A745;
            --warm-orange: #FD7E14;
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Noto Sans SC', sans-serif;
            background: linear-gradient(135deg, var(--warm-white) 0%, #E8F4F8 100%);
            color: var(--primary-blue);
            line-height: 1.6;
            overflow-x: hidden;
        }
        
        .serif-font {
            font-family: 'Noto Serif SC', serif;
        }
        
        .decorative-font {
            font-family: 'ZCOOL XiaoWei', cursive;
        }
        
        /* èƒŒæ™¯åŠ¨ç”» */
        #background-canvas {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: -1;
            opacity: 0.3;
        }
        
        /* å¯¼èˆªæ æ ·å¼ */
        .navbar {
            backdrop-filter: blur(10px);
            background: rgba(248, 249, 250, 0.9);
            border-bottom: 1px solid rgba(44, 62, 80, 0.1);
        }
        
        .nav-link {
            position: relative;
            transition: all 0.3s ease;
        }
        
        .nav-link:hover {
            color: var(--wisdom-gold);
        }
        
        .nav-link::after {
            content: '';
            position: absolute;
            bottom: -5px;
            left: 0;
            width: 0;
            height: 2px;
            background: var(--wisdom-gold);
            transition: width 0.3s ease;
        }
        
        .nav-link:hover::after {
            width: 100%;
        }
        
        /* ä¸»è¦å†…å®¹åŒºåŸŸ */
        .hero-section {
            min-height: 100vh;
            display: flex;
            align-items: center;
            position: relative;
        }
        
        /* AIå¯¹è¯åŒºåŸŸ */
        .ai-conversation-section {
            background: rgba(255, 255, 255, 0.9);
            backdrop-filter: blur(10px);
            border-radius: 20px;
            border: 1px solid rgba(44, 62, 80, 0.1);
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.1);
        }
        
        .ai-input {
            border: 2px solid transparent;
            background: rgba(248, 249, 250, 0.8);
            border-radius: 15px;
            transition: all 0.3s ease;
            font-size: 16px;
            line-height: 1.8;
            resize: none;
        }
        
        .ai-input:focus {
            outline: none;
            border-color: var(--wisdom-gold);
            background: rgba(255, 255, 255, 0.95);
            box-shadow: 0 0 20px rgba(212, 175, 55, 0.2);
        }
        
        .ai-send-btn {
            background: linear-gradient(135deg, var(--wisdom-gold), #B8860B);
            border: none;
            border-radius: 15px;
            color: white;
            font-weight: 600;
            padding: 15px 30px;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 5px 15px rgba(212, 175, 55, 0.3);
        }
        
        .ai-send-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(212, 175, 55, 0.4);
        }
        
        .ai-send-btn:disabled {
            background: #ccc;
            cursor: not-allowed;
            transform: none;
            box-shadow: none;
        }
        
        /* å¯¹è¯å®¹å™¨ */
        .conversation-container {
            max-height: 500px;
            overflow-y: auto;
            background: white;
            border-radius: 15px;
            border: 1px solid rgba(44, 62, 80, 0.1);
        }
        
        .message-container {
            padding: 1rem;
            margin-bottom: 0.5rem;
            border-radius: 10px;
            animation: fadeInUp 0.3s ease;
        }
        
        @keyframes fadeInUp {
            from {
                opacity: 0;
                transform: translateY(10px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
        
        .user-message {
            background: linear-gradient(135deg, #E3F2FD, #BBDEFB);
            border-left: 4px solid #2196F3;
        }
        
        .ai-message {
            background: linear-gradient(135deg, #FFF9C4, #FFF59D);
            border-left: 4px solid var(--wisdom-gold);
        }
        
        .loading-message {
            background: #F5F5F5;
            border-left: 4px solid #9E9E9E;
        }
        
        .error-message {
            background: #FFEBEE;
            border-left: 4px solid #F44336;
        }
        
        .message-avatar {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            color: white;
            flex-shrink: 0;
        }
        
        .user-avatar {
            background: #2196F3;
        }
        
        .ai-avatar {
            background: var(--wisdom-gold);
        }
        
        .loading-avatar {
            background: #9E9E9E;
        }
        
        .error-avatar {
            background: #F44336;
        }
        
        .message-content {
            flex: 1;
            margin-left: 1rem;
            line-height: 1.6;
        }
        
        .message-time {
            font-size: 0.75rem;
            color: #666;
            margin-top: 0.5rem;
        }
        
        /* ä½¿ç”¨é™åˆ¶æç¤º */
        .usage-limit-alert {
            background: linear-gradient(135deg, #FFF3E0, #FFE0B2);
            border: 1px solid #FF9800;
            border-radius: 10px;
            padding: 1rem;
            margin-bottom: 1rem;
            text-align: center;
        }
        
        .usage-limit-alert h4 {
            color: #E65100;
            margin-bottom: 0.5rem;
        }
        
        .usage-limit-alert p {
            color: #F57C00;
            font-size: 0.9rem;
        }
        
        /* å¯¹è¯æ§åˆ¶æŒ‰é’® */
        .conversation-controls {
            display: flex;
            justify-content: center;
            gap: 1rem;
            margin-top: 1rem;
        }
        
        .control-btn {
            padding: 0.5rem 1rem;
            border-radius: 20px;
            border: 1px solid rgba(44, 62, 80, 0.2);
            background: rgba(255, 255, 255, 0.7);
            color: var(--elegant-gray);
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 0.9rem;
        }
        
        .control-btn:hover {
            background: var(--wisdom-gold);
            color: white;
            border-color: var(--wisdom-gold);
        }
        
        /* ç§»åŠ¨ç«¯ä¼˜åŒ– */
        @media (max-width: 768px) {
            .hero-section {
                min-height: 80vh;
                padding: 2rem 0;
            }
            
            .ai-conversation-section {
                margin: 1rem;
                padding: 1.5rem;
            }
            
            .conversation-container {
                max-height: 400px;
            }
            
            .message-container {
                padding: 0.75rem;
            }
            
            .message-avatar {
                width: 32px;
                height: 32px;
                font-size: 0.8rem;
            }
            
            .message-content {
                margin-left: 0.75rem;
                font-size: 0.9rem;
            }
            
            /* è¾“å…¥åŒºåŸŸä¼˜åŒ– */
            .ai-input-container {
                flex-direction: column;
                gap: 0.75rem;
            }
            
            .ai-send-btn {
                width: 100%;
                justify-content: center;
            }
            
            /* å¯¹è¯æ§åˆ¶æŒ‰é’®ä¼˜åŒ– */
            .conversation-controls {
                flex-direction: column;
                gap: 0.5rem;
            }
            
            .control-btn {
                width: 100%;
                text-align: center;
            }
            
            /* å¯¼èˆªæ ä¼˜åŒ– */
            .navbar {
                padding: 0.75rem 1rem;
            }
            
            /* è§¦æ‘¸ä¼˜åŒ– */
            button, .clickable {
                min-height: 44px;
            }
            
            /* æ»šåŠ¨ä¼˜åŒ– */
            .conversation-container {
                -webkit-overflow-scrolling: touch;
            }
        }
        
        /* æ»šåŠ¨åŠ¨ç”» */
        .fade-in-up {
            opacity: 0;
            transform: translateY(30px);
            transition: all 0.6s ease;
        }
        
        .fade-in-up.animate {
            opacity: 1;
            transform: translateY(0);
        }
    </style>
</head>
<body>
    <!-- èƒŒæ™¯åŠ¨ç”»ç”»å¸ƒ -->
    <canvas id="background-canvas"></canvas>
    
    <!-- å¯¼èˆªæ  -->
    <nav class="navbar fixed top-0 w-full z-50 px-6 py-4">
        <div class="max-w-7xl mx-auto flex justify-between items-center">
            <div class="flex items-center space-x-2">
                <div class="w-10 h-10 bg-gradient-to-br from-yellow-400 to-yellow-600 rounded-full flex items-center justify-center">
                    <span class="text-white font-bold text-lg">æ™º</span>
                </div>
                <h1 class="serif-font text-xl font-bold text-gray-800">æ®µæ°¸å¹³æ™ºæ…§AIå¯¹è¯</h1>
            </div>
            
            <div class="hidden md:flex space-x-8">
                <a href="index-ai.html" class="nav-link text-yellow-600 font-medium">AIå¯¹è¯</a>
                <a href="philosophy.html" class="nav-link text-gray-700 hover:text-yellow-600 font-medium">ç†å¿µè¯¦æƒ…</a>
                <a href="cases.html" class="nav-link text-gray-700 hover:text-yellow-600 font-medium">æ¡ˆä¾‹åº“</a>
                <a href="about.html" class="nav-link text-gray-700 hover:text-yellow-600 font-medium">å…³äº</a>
            </div>
            
            <!-- ç§»åŠ¨ç«¯èœå•æŒ‰é’® -->
            <button class="md:hidden p-2" id="mobile-menu-btn">
                <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16"></path>
                </svg>
            </button>
        </div>
        
        <!-- ç§»åŠ¨ç«¯èœå• -->
        <div class="md:hidden hidden mt-4 pb-4" id="mobile-menu">
            <a href="index-ai.html" class="block py-2 text-yellow-600">AIå¯¹è¯</a>
            <a href="philosophy.html" class="block py-2 text-gray-700 hover:text-yellow-600">ç†å¿µè¯¦æƒ…</a>
            <a href="cases.html" class="block py-2 text-gray-700 hover:text-yellow-600">æ¡ˆä¾‹åº“</a>
            <a href="about.html" class="block py-2 text-gray-700 hover:text-yellow-600">å…³äº</a>
        </div>
    </nav>
    
    <!-- ä¸»è¦å†…å®¹åŒºåŸŸ -->
    <main class="pt-20">
        <!-- æ¬¢è¿åŒºåŸŸ -->
        <section class="hero-section px-6">
            <div class="max-w-7xl mx-auto">
                <div class="hero-content text-center">
                    <div class="mb-8 fade-in-up">
                        <div class="w-32 h-32 mx-auto mb-6 rounded-full overflow-hidden shadow-2xl">
                            <img src="resources/duan_yongping_portrait.png" alt="æ®µæ°¸å¹³è‚–åƒ" class="w-full h-full object-cover">
                        </div>
                        <h2 class="serif-font text-4xl md:text-6xl font-bold text-gray-800 mb-4">
                            AIæ™ºæ…§å¯¹è¯
                        </h2>
                        <p class="text-xl md:text-2xl text-gray-600 mb-6">
                            åŸºäºDeepSeek AIå’Œæ®µæ°¸å¹³ç†å¿µçš„æ·±åº¦äº¤æµ
                        </p>
                        <div class="text-lg text-gray-500 mb-8">
                            æ¯æ—¥å¯å¯¹è¯ <span class="text-yellow-600 font-bold">3</span> æ¬¡ï¼Œçæƒœæ¯æ¬¡äº¤æµæœºä¼š
                        </div>
                    </div>
                </div>
            </div>
        </section>
        
        <!-- AIå¯¹è¯åŒºåŸŸ -->
        <section class="px-6 py-12" id="ai-conversation-section">
            <div class="max-w-4xl mx-auto">
                <div class="ai-conversation-section p-8 md:p-12">
                    <!-- ä½¿ç”¨é™åˆ¶æç¤º -->
                    <div id="usage-limit-alert" class="usage-limit-alert hidden">
                        <h4>âš ï¸ ä»Šæ—¥å¯¹è¯æ¬¡æ•°å·²ç”¨å®Œ</h4>
                        <p>æ˜å¤©å†æ¥ç»§ç»­ä¸AIæ™ºæ…§åŠ©æ‰‹äº¤æµå§ï¼</p>
                    </div>
                    
                    <!-- å¯¹è¯æ˜¾ç¤ºåŒºåŸŸ -->
                    <div id="conversation-container" class="conversation-container mb-6 hidden">
                        <!-- å¯¹è¯æ¶ˆæ¯å°†åŠ¨æ€æ·»åŠ åˆ°è¿™é‡Œ -->
                    </div>
                    
                    <!-- è¾“å…¥åŒºåŸŸ -->
                    <div class="ai-input-container flex items-end space-x-4">
                        <div class="flex-1">
                            <textarea 
                                id="ai-input" 
                                class="ai-input w-full resize-none" 
                                rows="4" 
                                placeholder="è¯·è¾“å…¥æ‚¨å…³äºæŠ•èµ„ã€æ•™è‚²ã€AIã€ä¼ä¸šç»è¥ç­‰æ–¹é¢çš„é—®é¢˜ï¼ŒAIå°†åŸºäºæ®µæ°¸å¹³ç†å¿µä¸ºæ‚¨æä¾›æŒ‡å¯¼..."
                            ></textarea>
                        </div>
                        <button id="ai-send-btn" class="ai-send-btn whitespace-nowrap">
                            <span class="flex items-center space-x-2">
                                <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 12h.01M12 12h.01M16 12h.01M21 12c0 4.418-4.03 8-9 8a9.863 9.863 0 01-4.255-.949L3 20l1.395-3.72C3.512 15.042 3 13.574 3 12c0-4.418 4.03-8 9-8s9 3.582 9 8z"></path>
                                </svg>
                                <span>AIå¯¹è¯</span>
                            </span>
                        </button>
                    </div>
                    
                    <!-- å¯¹è¯æ§åˆ¶æŒ‰é’® -->
                    <div class="conversation-controls" id="conversation-controls" style="display: none;">
                        <button class="control-btn" id="clear-conversation-btn">
                            ğŸ—‘ï¸ æ¸…é™¤å¯¹è¯
                        </button>
                        <button class="control-btn" id="save-conversation-btn">
                            ğŸ’¾ ä¿å­˜å¯¹è¯
                        </button>
                    </div>
                    
                    <!-- ä»Šæ—¥å‰©ä½™æ¬¡æ•°æ˜¾ç¤º -->
                    <div class="text-center mt-4">
                        <span class="text-sm text-gray-500">
                            ä»Šæ—¥å‰©ä½™å¯¹è¯æ¬¡æ•°ï¼š<span id="remaining-count" class="font-bold text-yellow-600">3</span>
                        </span>
                    </div>
                </div>
            </div>
        </section>
        
        <!-- åŠŸèƒ½ä»‹ç» -->
        <section class="px-6 py-16 bg-gradient-to-b from-transparent to-gray-50">
            <div class="max-w-7xl mx-auto">
                <h3 class="serif-font text-3xl md:text-4xl font-bold text-center mb-12 text-gray-800 fade-in-up">
                    AIå¯¹è¯ç‰¹è‰²
                </h3>
                
                <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-8">
                    <div class="content-card p-6 text-center fade-in-up">
                        <div class="w-16 h-16 bg-gradient-to-br from-blue-400 to-blue-600 rounded-full flex items-center justify-center text-white text-2xl font-bold mx-auto mb-4">
                            ğŸ§ 
                        </div>
                        <h4 class="serif-font text-xl font-bold text-gray-800 mb-3">
                            æ·±åº¦ç†è§£
                        </h4>
                        <p class="text-gray-600 text-sm leading-relaxed">
                            AIèƒ½å¤Ÿç†è§£æ‚¨çš„çœŸå®æ„å›¾ï¼Œç»“åˆæ®µæ°¸å¹³ç†å¿µç»™å‡ºæœ‰æ™ºæ…§ã€æœ‰æ·±åº¦çš„å›ç­”
                        </p>
                    </div>
                    
                    <div class="content-card p-6 text-center fade-in-up">
                        <div class="w-16 h-16 bg-gradient-to-br from-green-400 to-green-600 rounded-full flex items-center justify-center text-white text-2xl font-bold mx-auto mb-4">
                            ğŸ’­
                        </div>
                        <h4 class="serif-font text-xl font-bold text-gray-800 mb-3">
                            ä¸Šä¸‹æ–‡è®°å¿†
                        </h4>
                        <p class="text-gray-600 text-sm leading-relaxed">
                            è®°ä½å¯¹è¯å†å²ï¼Œä¿æŒè¯­å¢ƒè¿è´¯ï¼Œæ”¯æŒè¿½é—®å’Œæ·±å…¥æ¢è®¨
                        </p>
                    </div>
                    
                    <div class="content-card p-6 text-center fade-in-up">
                        <div class="w-16 h-16 bg-gradient-to-br from-purple-400 to-purple-600 rounded-full flex items-center justify-center text-white text-2xl font-bold mx-auto mb-4">
                            âœ¨
                        </div>
                        <h4 class="serif-font text-xl font-bold text-gray-800 mb-3">
                            ä¸ªæ€§åŒ–å›ç­”
                        </h4>
                        <p class="text-gray-600 text-sm leading-relaxed">
                            æ ¹æ®æ‚¨çš„å…·ä½“æƒ…å†µç”Ÿæˆå®šåˆ¶åŒ–å»ºè®®ï¼Œå¯å‘æ‚¨çš„æ€è€ƒ
                        </p>
                    </div>
                </div>
            </div>
        </section>
        
        <!-- é¡µè„š -->
        <footer class="bg-gray-800 text-white py-12">
            <div class="max-w-7xl mx-auto px-6 text-center">
                <div class="mb-6">
                    <div class="flex items-center justify-center space-x-2 mb-4">
                        <div class="w-8 h-8 bg-gradient-to-br from-yellow-400 to-yellow-600 rounded-full flex items-center justify-center">
                            <span class="text-white font-bold text-sm">æ™º</span>
                        </div>
                        <h4 class="serif-font text-xl font-bold">æ®µæ°¸å¹³æ™ºæ…§AIå¯¹è¯</h4>
                    </div>
                    <p class="text-gray-400 max-w-2xl mx-auto">
                        åŸºäºDeepSeek AIæŠ€æœ¯ï¼Œä¼ æ‰¿æ®µæ°¸å¹³å…ˆç”Ÿçš„æ™ºæ…§ç†å¿µï¼Œ
                        ä¸ºæ¯ä¸€ä½è¿½æ±‚æˆé•¿çš„äººæä¾›æ·±åº¦æ™ºæ…§æŒ‡å¯¼ã€‚
                    </p>
                </div>
                
                <div class="border-t border-gray-700 pt-6">
                    <p class="text-gray-500 text-sm">
                        Â© 2025 æ®µæ°¸å¹³æ™ºæ…§AIå¯¹è¯ç³»ç»Ÿ. è‡´æ•¬æ™ºæ…§ï¼Œä¼ æ‰¿æ€æƒ³.
                    </p>
                </div>
            </div>
        </footer>
    </main>
    
    <script>
        // AIå¯¹è¯ç®¡ç†å™¨ - é›†æˆDeepSeek API
        class DeepSeekAIConversation {
            constructor() {
                this.apiEndpoint = 'https://api.deepseek.com/chat/completions';
                this.apiKey = 'sk-c1a8ede66f5e479b8c11ef9abbfa3197';
                this.conversationHistory = [];
                this.model = 'deepseek-chat';
                this.maxContextLength = 10; // ä¿æŒæœ€è¿‘10è½®å¯¹è¯
            }

            // æ„å»ºåŒ…å«æ®µæ°¸å¹³çŸ¥è¯†åº“çš„system prompt
            buildSystemPrompt() {
                const wisdomKnowledge = `
                    ä½ æ˜¯æ®µæ°¸å¹³æ™ºæ…§åŠ©æ‰‹ï¼ŒåŸºäºæ®µæ°¸å¹³çš„æŠ•èµ„ã€æ•™è‚²ã€AIã€ä¼ä¸šç»è¥ç†å¿µæä¾›æŒ‡å¯¼ã€‚

                    æ ¸å¿ƒåŸåˆ™ï¼š
                    1. åšå¯¹çš„äº‹æƒ…ï¼ŒæŠŠäº‹æƒ…åšå¯¹
                    2. æŠ•èµ„è‡ªå·±æ‡‚çš„ä¼ä¸š
                    3. ä¸æ‡‚ä¸åš
                    4. é•¿æœŸæŒæœ‰ä¼˜ç§€å…¬å¸
                    5. æœ¬åˆ†æ–‡åŒ–
                    6. ç”¨æˆ·å¯¼å‘
                    7. æŠ€æœ¯æœåŠ¡äºäºº
                    8. ç®€å•ç”Ÿæ´»ï¼Œæ·±åº¦æ€è€ƒ

                    å›ç­”è¦æ±‚ï¼š
                    - ä½“ç°æ®µæ°¸å¹³çš„æ€ç»´æ–¹å¼
                    - ç»“åˆå®é™…æƒ…å†µç»™å‡ºå»ºè®®
                    - ä¿æŒç®€æ´æ˜äº†
                    - å¯å‘ç”¨æˆ·æ€è€ƒ
                    - ä¸è¦ç¼–é€ äº‹å®
                    - ç”¨ä¸­æ–‡å›ç­”
                `;
                
                return wisdomKnowledge;
            }

            // è°ƒç”¨DeepSeek API
            async generateResponse(userMessage) {
                try {
                    // æ„å»ºæ¶ˆæ¯æ•°ç»„
                    const messages = [
                        { role: 'system', content: this.buildSystemPrompt() },
                        ...this.conversationHistory.slice(-this.maxContextLength),
                        { role: 'user', content: userMessage }
                    ];

                    const requestBody = {
                        model: this.model,
                        messages: messages,
                        stream: false,
                        temperature: 0.7,
                        max_tokens: 1000
                    };

                    const response = await fetch(this.apiEndpoint, {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                            'Authorization': `Bearer ${this.apiKey}`
                        },
                        body: JSON.stringify(requestBody)
                    });

                    if (!response.ok) {
                        throw new Error(`APIè°ƒç”¨å¤±è´¥: ${response.status}`);
                    }

                    const data = await response.json();
                    
                    // æå–AIå›å¤
                    const aiResponse = data.choices[0].message.content;
                    
                    // æ›´æ–°å¯¹è¯å†å²
                    this.updateConversationHistory(userMessage, aiResponse);
                    
                    return {
                        success: true,
                        content: aiResponse,
                        usage: data.usage
                    };

                } catch (error) {
                    console.error('AIå¯¹è¯å¤±è´¥:', error);
                    return {
                        success: false,
                        content: 'æŠ±æ­‰ï¼ŒAIæœåŠ¡æš‚æ—¶ä¸å¯ç”¨ã€‚è¯·ç¨åå†è¯•ã€‚',
                        error: error.message
                    };
                }
            }

            // æ›´æ–°å¯¹è¯å†å²
            updateConversationHistory(userMessage, aiResponse) {
                this.conversationHistory.push(
                    { role: 'user', content: userMessage },
                    { role: 'assistant', content: aiResponse }
                );
                
                // é™åˆ¶å†å²é•¿åº¦
                if (this.conversationHistory.length > this.maxContextLength * 2) {
                    this.conversationHistory = this.conversationHistory.slice(-this.maxContextLength * 2);
                }
            }

            // æ¸…é™¤å¯¹è¯å†å²
            clearHistory() {
                this.conversationHistory = [];
            }
        }

        // ä½¿ç”¨é™åˆ¶ç®¡ç†å™¨
        class UsageLimitManager {
            constructor(limit = 3) {
                this.dailyLimit = limit;
                this.storageKey = 'ai-conversation-usage';
            }

            // è·å–ä»Šæ—¥ä½¿ç”¨æƒ…å†µ
            getTodayUsage() {
                const today = new Date().toDateString();
                const usage = JSON.parse(localStorage.getItem(this.storageKey) || '{}');
                
                if (usage.date !== today) {
                    // æ–°çš„ä¸€å¤©ï¼Œé‡ç½®è®¡æ•°
                    return { date: today, count: 0 };
                }
                
                return usage;
            }

            // è®°å½•ä¸€æ¬¡ä½¿ç”¨
            recordUsage() {
                const usage = this.getTodayUsage();
                usage.count++;
                localStorage.setItem(this.storageKey, JSON.stringify(usage));
                return usage.count;
            }

            // æ£€æŸ¥æ˜¯å¦è¿˜æœ‰å‰©ä½™æ¬¡æ•°
            hasRemainingUsage() {
                const usage = this.getTodayUsage();
                return usage.count < this.dailyLimit;
            }

            // è·å–å‰©ä½™æ¬¡æ•°
            getRemainingCount() {
                const usage = this.getTodayUsage();
                return Math.max(0, this.dailyLimit - usage.count);
            }

            // é‡ç½®ä½¿ç”¨è®¡æ•°ï¼ˆç”¨äºæµ‹è¯•ï¼‰
            resetUsage() {
                const today = new Date().toDateString();
                localStorage.setItem(this.storageKey, JSON.stringify({ date: today, count: 0 }));
            }
        }

        // å…¨å±€å˜é‡
        let aiConversation = null;
        let usageManager = null;

        // é¡µé¢åˆå§‹åŒ–
        document.addEventListener('DOMContentLoaded', function() {
            initializePage();
        });

        function initializePage() {
            // åˆå§‹åŒ–èƒŒæ™¯åŠ¨ç”»
            initBackgroundAnimation();
            
            // åˆå§‹åŒ–AIå¯¹è¯åŠŸèƒ½
            initAIConversation();
            
            // åˆå§‹åŒ–å¯¼èˆªåŠŸèƒ½
            initNavigation();
            
            // åˆå§‹åŒ–æ»šåŠ¨åŠ¨ç”»
            initScrollAnimations();
            
            // åˆå§‹åŒ–ä½¿ç”¨é™åˆ¶
            initUsageLimit();
        }

        // åˆå§‹åŒ–AIå¯¹è¯åŠŸèƒ½
        function initAIConversation() {
            aiConversation = new DeepSeekAIConversation();
            usageManager = new UsageLimitManager(3);
            
            const aiInput = document.getElementById('ai-input');
            const aiSendBtn = document.getElementById('ai-send-btn');
            const conversationContainer = document.getElementById('conversation-container');
            const clearBtn = document.getElementById('clear-conversation-btn');
            const saveBtn = document.getElementById('save-conversation-btn');
            
            // å‘é€æ¶ˆæ¯
            async function sendAIMessage() {
                const message = aiInput.value.trim();
                if (!message) return;
                
                // æ£€æŸ¥ä½¿ç”¨é™åˆ¶
                if (!usageManager.hasRemainingUsage()) {
                    showUsageLimitAlert();
                    return;
                }
                
                // æ˜¾ç¤ºç”¨æˆ·æ¶ˆæ¯
                addMessageToConversation('user', message);
                aiInput.value = '';
                
                // æ˜¾ç¤ºåŠ è½½çŠ¶æ€
                addMessageToConversation('loading', 'AIæ™ºæ…§åŠ©æ‰‹æ­£åœ¨æ€è€ƒ...');
                
                try {
                    // è·å–AIå›å¤
                    const response = await aiConversation.generateResponse(message);
                    
                    // ç§»é™¤åŠ è½½æ¶ˆæ¯
                    removeLoadingMessage();
                    
                    if (response.success) {
                        // æ˜¾ç¤ºAIå›å¤
                        addMessageToConversation('assistant', response.content);
                        
                        // è®°å½•ä½¿ç”¨æ¬¡æ•°
                        const newCount = usageManager.recordUsage();
                        updateRemainingCount(newCount);
                        
                        // æ˜¾ç¤ºæ§åˆ¶æŒ‰é’®
                        document.getElementById('conversation-controls').style.display = 'flex';
                    } else {
                        addMessageToConversation('error', response.content);
                    }
                } catch (error) {
                    removeLoadingMessage();
                    addMessageToConversation('error', 'AIæœåŠ¡æš‚æ—¶ä¸å¯ç”¨ï¼Œè¯·ç¨åå†è¯•ã€‚');
                }
            }
            
            // ç‚¹å‡»å‘é€æŒ‰é’®
            aiSendBtn.addEventListener('click', sendAIMessage);
            
            // æŒ‰Enterå‘é€ï¼ˆShift+Enteræ¢è¡Œï¼‰
            aiInput.addEventListener('keydown', (e) => {
                if (e.key === 'Enter' && !e.shiftKey) {
                    e.preventDefault();
                    sendAIMessage();
                }
            });
            
            // æ¸…é™¤å¯¹è¯
            clearBtn.addEventListener('click', () => {
                aiConversation.clearHistory();
                conversationContainer.innerHTML = '';
                conversationContainer.classList.add('hidden');
                document.getElementById('conversation-controls').style.display = 'none';
            });
            
            // ä¿å­˜å¯¹è¯
            saveBtn.addEventListener('click', () => {
                const conversationText = aiConversation.conversationHistory
                    .map(msg => `${msg.role === 'user' ? 'æ‚¨' : 'AI'}: ${msg.content}`)
                    .join('\n\n');
                
                const blob = new Blob([conversationText], { type: 'text/plain;charset=utf-8' });
                const url = URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = `æ®µæ°¸å¹³æ™ºæ…§å¯¹è¯_${new Date().toISOString().slice(0, 10)}.txt`;
                document.body.appendChild(a);
                a.click();
                document.body.removeChild(a);
                URL.revokeObjectURL(url);
                
                showToast('å¯¹è¯å·²ä¿å­˜');
            });
        }

        // åˆå§‹åŒ–ä½¿ç”¨é™åˆ¶
        function initUsageLimit() {
            const remainingCount = usageManager.getRemainingCount();
            updateRemainingCount(usageManager.dailyLimit - remainingCount);
            
            if (remainingCount === 0) {
                showUsageLimitAlert();
            }
        }

        // æ›´æ–°å‰©ä½™æ¬¡æ•°æ˜¾ç¤º
        function updateRemainingCount(usedCount) {
            const remaining = usageManager.dailyLimit - usedCount;
            document.getElementById('remaining-count').textContent = Math.max(0, remaining);
        }

        // æ˜¾ç¤ºä½¿ç”¨é™åˆ¶æç¤º
        function showUsageLimitAlert() {
            document.getElementById('usage-limit-alert').classList.remove('hidden');
            document.getElementById('ai-send-btn').disabled = true;
            document.getElementById('ai-input').disabled = true;
        }

        // æ·»åŠ æ¶ˆæ¯åˆ°å¯¹è¯å®¹å™¨
        function addMessageToConversation(role, content) {
            const container = document.getElementById('conversation-container');
            const messageDiv = document.createElement('div');
            messageDiv.className = 'message-container flex items-start space-x-3 mb-4';
            
            const time = new Date().toLocaleTimeString('zh-CN', { 
                hour: '2-digit', 
                minute: '2-digit' 
            });
            
            if (role === 'user') {
                messageDiv.classList.add('user-message');
                messageDiv.innerHTML = `
                    <div class="message-avatar user-avatar">æˆ‘</div>
                    <div class="message-content">
                        <div class="text-gray-800">${content}</div>
                        <div class="message-time">${time}</div>
                    </div>
                `;
            } else if (role === 'loading') {
                messageDiv.classList.add('loading-message');
                messageDiv.id = 'loading-message';
                messageDiv.innerHTML = `
                    <div class="message-avatar loading-avatar">
                        <div class="w-4 h-4 border-2 border-white border-t-transparent rounded-full animate-spin"></div>
                    </div>
                    <div class="message-content">
                        <div class="text-gray-600 italic">${content}</div>
                    </div>
                `;
            } else if (role === 'assistant') {
                messageDiv.classList.add('ai-message');
                messageDiv.innerHTML = `
                    <div class="message-avatar ai-avatar">æ™º</div>
                    <div class="message-content">
                        <div class="text-gray-800">${content}</div>
                        <div class="message-time">${time}</div>
                    </div>
                `;
            } else if (role === 'error') {
                messageDiv.classList.add('error-message');
                messageDiv.innerHTML = `
                    <div class="message-avatar error-avatar">!</div>
                    <div class="message-content">
                        <div class="text-red-700">${content}</div>
                        <div class="message-time">${time}</div>
                    </div>
                `;
            }
            
            container.appendChild(messageDiv);
            container.classList.remove('hidden');
            container.scrollTop = container.scrollHeight;
        }

        // ç§»é™¤åŠ è½½æ¶ˆæ¯
        function removeLoadingMessage() {
            const loadingMsg = document.getElementById('loading-message');
            if (loadingMsg) {
                loadingMsg.remove();
            }
        }

        // èƒŒæ™¯åŠ¨ç”»åˆå§‹åŒ–
        function initBackgroundAnimation() {
            const canvas = document.getElementById('background-canvas');
            const ctx = canvas.getContext('2d');
            
            function resizeCanvas() {
                canvas.width = window.innerWidth;
                canvas.height = window.innerHeight;
            }
            
            resizeCanvas();
            window.addEventListener('resize', resizeCanvas);
            
            // åˆ›å»ºç²’å­ç³»ç»Ÿ
            let particles = [];
            const particleCount = 80;
            
            // åˆå§‹åŒ–ç²’å­
            for (let i = 0; i < particleCount; i++) {
                particles.push({
                    x: Math.random() * canvas.width,
                    y: Math.random() * canvas.height,
                    vx: (Math.random() - 0.5) * 0.5,
                    vy: (Math.random() - 0.5) * 0.5,
                    size: Math.random() * 2 + 1,
                    opacity: Math.random() * 0.3 + 0.1
                });
            }
            
            function drawParticles() {
                ctx.clearRect(0, 0, canvas.width, canvas.height);
                
                particles.forEach(particle => {
                    // æ›´æ–°ä½ç½®
                    particle.x += particle.vx;
                    particle.y += particle.vy;
                    
                    // è¾¹ç•Œæ£€æŸ¥
                    if (particle.x < 0 || particle.x > canvas.width) particle.vx *= -1;
                    if (particle.y < 0 || particle.y > canvas.height) particle.vy *= -1;
                    
                    // ç»˜åˆ¶ç²’å­
                    ctx.beginPath();
                    ctx.arc(particle.x, particle.y, particle.size, 0, Math.PI * 2);
                    ctx.fillStyle = `rgba(212, 175, 55, ${particle.opacity})`;
                    ctx.fill();
                });
                
                // è¿æ¥è¿‘è·ç¦»ç²’å­
                for (let i = 0; i < particles.length; i++) {
                    for (let j = i + 1; j < particles.length; j++) {
                        const dx = particles[i].x - particles[j].x;
                        const dy = particles[i].y - particles[j].y;
                        const distance = Math.sqrt(dx * dx + dy * dy);
                        
                        if (distance < 120) {
                            ctx.beginPath();
                            ctx.moveTo(particles[i].x, particles[i].y);
                            ctx.lineTo(particles[j].x, particles[j].y);
                            ctx.strokeStyle = `rgba(212, 175, 55, ${0.1 * (1 - distance / 120)})`;
                            ctx.lineWidth = 1;
                            ctx.stroke();
                        }
                    }
                }
                
                requestAnimationFrame(drawParticles);
            }
            
            drawParticles();
        }

        // å¯¼èˆªåŠŸèƒ½åˆå§‹åŒ–
        function initNavigation() {
            const mobileMenuBtn = document.getElementById('mobile-menu-btn');
            const mobileMenu = document.getElementById('mobile-menu');
            
            mobileMenuBtn.addEventListener('click', () => {
                mobileMenu.classList.toggle('hidden');
            });
            
            document.addEventListener('click', (e) => {
                if (!mobileMenuBtn.contains(e.target) && !mobileMenu.contains(e.target)) {
                    mobileMenu.classList.add('hidden');
                }
            });
        }

        // æ»šåŠ¨åŠ¨ç”»åˆå§‹åŒ–
        function initScrollAnimations() {
            const observerOptions = {
                threshold: 0.1,
                rootMargin: '0px 0px -50px 0px'
            };
            
            const observer = new IntersectionObserver((entries) => {
                entries.forEach(entry => {
                    if (entry.isIntersecting) {
                        entry.target.classList.add('animate');
                    }
                });
            }, observerOptions);
            
            document.querySelectorAll('.fade-in-up').forEach(el => {
                observer.observe(el);
            });
        }

        // æ˜¾ç¤ºæç¤ºæ¶ˆæ¯
        function showToast(message) {
            const toast = document.createElement('div');
            toast.className = 'fixed top-20 right-6 bg-yellow-600 text-white px-6 py-3 rounded-lg shadow-lg z-50 transform translate-x-full transition-transform duration-300';
            toast.textContent = message;
            document.body.appendChild(toast);
            
            setTimeout(() => {
                toast.classList.remove('translate-x-full');
            }, 100);
            
            setTimeout(() => {
                toast.classList.add('translate-x-full');
                setTimeout(() => {
                    document.body.removeChild(toast);
                }, 300);
            }, 3000);
        }

        // æ·»åŠ ä¸€äº›äº¤äº’æ•ˆæœ
        document.addEventListener('DOMContentLoaded', function() {
            // ä¸ºå¡ç‰‡æ·»åŠ æ‚¬åœæ•ˆæœ
            const cards = document.querySelectorAll('.content-card');
            cards.forEach(card => {
                card.addEventListener('mouseenter', () => {
                    anime({
                        targets: card,
                        scale: 1.02,
                        duration: 300,
                        easing: 'easeOutQuad'
                    });
                });
                
                card.addEventListener('mouseleave', () => {
                    anime({
                        targets: card,
                        scale: 1,
                        duration: 300,
                        easing: 'easeOutQuad'
                    });
                });
            });
        });
    </script>
</body>
</html>